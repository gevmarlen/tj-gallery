/*!
 * tjGallery 0.9
 * http://tj-s.ru
 * @copyright	Tod, tod@tj-s.ru
 * @license		MIT License
 */
!function(t){var i={init:function(e){var n=t.extend({selector:"img",row_min_height:180,margin:5},e);return this.each(function(){function e(){i.clear.apply(r),h(r)}function h(i){return i.each(function(){var i=t(this),e=i.width(),h=[],r={items:[],width:0,height:0};i.find(n.selector).each(function(){var i=t(this),s=i;if("IMG"!=s[0].nodeName.toUpperCase()?(s=s.find("img"),i=t('<div class="tjGalleryItem">').insertBefore(i).append(i)):i=t('<div class="tjGalleryItem">').insertBefore(s).append(s),s.length){i.css({width:"auto","float":"left",position:"relative"});var c={pic:s,container:i,original_height:s.attr("height")||s.height(),original_width:s.attr("width")||s.width()};c.aspect=c.original_width/c.original_height,c.scale=n.row_min_height/c.original_height,c.width=c.original_width*c.scale,c.height=c.original_height*c.scale;var l=a(r.items,c);l>e&&(h.push(r),r={items:[],width:0,height:0}),r.items.push(c)}}),h.push(r),r.last=!0,t.each(h,function(i,h){h.last||(h.scale=(e-(h.items.length-1)*n.margin)/a(h.items));var r,s=0;if(t.each(h.items,function(t,i){h.scale&&(i.width=Math.round(i.width*h.scale),i.height=Math.round(i.height*h.scale)),i.index=s;var e=i.pic;i.container;r=i,s++,e.css({height:parseInt(i.height)+"px",width:parseInt(i.width)+"px"}),i.container.css({height:parseInt(i.height)+"px",width:parseInt(i.width)+"px",marginTop:n.margin+"px"}),t>0?i.container.css({marginLeft:n.margin+"px"}):i.container.css({clear:"left"})}),r){var c=r.width;if(r.width=r.width+e-a(h.items),h.last){if(r.width-c<40&&h.last){var l=r.width-c<0?0:r.width-c;t.each(h.items,function(t,i){var e=i.pic;i.container;e.css({width:i.width+l/h.items.length+"px",height:r.height*((r.width-l/h.items.length*(h.items.length-1))/c)+"px"}),i.container.css({width:i.width+l/h.items.length+"px",height:r.height*((r.width-l/h.items.length*(h.items.length-1))/c)+"px"})}),r.pic.css({width:r.width-l/h.items.length*(h.items.length-1)+"px"}),r.container.css({width:r.width-l/h.items.length*(h.items.length-1)+"px"})}}else r.pic.css({width:r.width+"px"}),r.container.css({width:r.width+"px"})}})})}function a(i,e){var h=0;return i.length&&(h=n.margin*(i.length-1),t.each(i,function(t,i){h+=i.width})),e&&(h+=e.width),h}var r=t(this),s=r.data("tjGallery");return s||r.data("tjGallery",{target:r,tjGallery:n}),t(window).bind("resize.tjGallery",e),h(r)})},clear:function(){conteiner=this,data=conteiner.data("tjGallery"),conteiner.each(function(){t(this).find(data.tjGallery.selector).each(function(){t(this).is("img")||t(this).find("img").css({width:"auto",height:"auto"}),t(this).removeAttr("style"),t(this).appendTo(conteiner)}),t(this).find("div:empty").remove()})},destroy:function(){i.clear.apply(this),t(window).unbind(".tjGallery")}};t.fn.tjGallery=function(e){if(i[e])return i[e].apply(this,Array.prototype.slice.call(arguments,1));if("object"==typeof e||!e){return i.init.apply(this,arguments)}t.error("Method "+e+" does not exist for jQuery.tjGallery")}}(jQuery);